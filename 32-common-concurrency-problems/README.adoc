= 32 Common Concurrency Problems
:figure-caption: Figure 32.
:table-caption!:
:toc: left

* Researchers have spent a great deal of time and effort looking into
  concurrency bugs over many years.
* Much of the early work focused on *deadlock*, a topic which we've touched on
  in the past chapters but will now dive into deeply [C+71].
* More recent work focuses on studying other types of common concurrency bugs (i.e., non-deadlock bugs).
* In this chapter, we take a brief look at some example concurrency problems
  found in real code bases, to better understand what problems to look out
  for.
* And thus our central issue for this chapter:

.CRUX: HOW TO HANDLE COMMON CONCURRENCY BUGS
****
* Concurrency bugs tend to come in a variety of common patterns.
* Knowing which ones to look out for is the first step to writing more robust,
  correct concurrent code.
****

== 32.1 What Types Of Bugs Exist?

* The first, and most obvious, question is this: what types of concurrency
  bugs manifest in complex, concurrent programs?
* This question is difficult to answer in general, but fortunately, some
  others have done the work for us.
* Specifically, we rely upon a study by Lu et al. [L+08], which analyzes a
  number of popular concurrent applications in great detail to understand what
  types of bugs arise in practice.

'''

* The study focuses on four major and important open-source applications:
  MySQL (a popular database management system), Apache (a well-known web
  server), Mozilla (the famous web browser), and OpenOffice (a free version of
  the MS Office suite, which some people actually use).
* In the study, the authors examine concurrency bugs that have been found and
  fixed in each of these code bases, turning the developers' work into a
  quantitative bug analysis; understanding these results can help you
  understand what types of problems actually occur in mature code bases.

'''

* Figure 32.1 shows a summary of the bugs Lu and colleagues studied.
* From the figure, you can see that there were 105 total bugs, most of which
  were not deadlock (74); the remaining 31 were deadlock bugs.
* Further, you can see the number of bugs studied from each application; while
  OpenOffice only had 8 total concurrency bugs, Mozilla had nearly 60.

:figure-number: {counter:figure-number}
.{figure-caption} {figure-number}. Bugs In Modern Applications
[%autowidth]
|===
|Application	|What it does	|Non-Deadlock	|Deadlock

|MySQL		|Database Server|14		|9
|Apache		|Web Server	|13		|4
|Mozilla	|Web Browser	|41		|16
|OpenOffice	|Office Suite	|6		|2
2+|Total			|74		|31
|===

* We now dive into these different classes of bugs (non-deadlock, deadlock) a
  bit more deeply.
* For the first class of non-deadlock bugs, we use examples from the study to
  drive our discussion.
* For the second class of deadlock bugs, we discuss the long line of work that
  has been done in either preventing, avoiding, or handling deadlock.

== References

[C+71] "System Deadlocks" by E.G. Coffman, M.J. Elphick, A. Shoshani. ACM Computing Surveys, 3:2, June 1971.::
* The classic paper outlining the conditions for deadlock and how you might go
  about dealing with it.
* There are certainly some earlier papers on this topic; see the references
  within this paper for details.

[L+08] "Learning from Mistakes -- A Comprehensive Study on Real World Concurrency Bug Characteristics" by Shan Lu, Soyeon Park, Eunsoo Seo, Yuanyuan Zhou. ASPLOS '08, March 2008, Seattle, Washington.::
* The first in-depth study of concurrency bugs in real software, and the basis
  for this chapter.
* Look at Y.Y. Zhou's or Shan Lu's web pages for many more interesting papers
  on bugs.
